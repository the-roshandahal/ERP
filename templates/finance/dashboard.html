{% load static %}{% include 'header.html' %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Main Content -->
<div class="hk-pg-wrapper">
	<div class="container-xxl">
		<!-- Page Header -->												
		<div class="hk-pg-header">
			<div class="d-flex">
				<div class="d-flex flex-wrap justify-content-between flex-1">
					<div class="mb-md-0 mb-2 me-8">
						<div class="d-flex align-items-center">
							<h1 class="pg-title">Accounting Dashboard</h1>
							<span class="badge badge-soft-primary ms-3">Badge</span>
						</div>
						<p id="greeting"></p>

						<script>
							const now = new Date();
							const hour = now.getHours();
					
							let greeting;
					
							if (hour < 12) {
								greeting = "Good Morning";
							} else if (hour < 18) {
								greeting = "Good Afternoon";
							} else {
								greeting = "Good Evening";
							}
					
							document.getElementById("greeting").innerHTML = greeting + " {{request.user.first_name}}!";
						</script>
						
					</div>
					
				</div>
			</div>
		</div>	

		
		<div class="row mt-3">
			<div class="col-xxl-12 col-lg-12 col-md-12 mb-md-4 mb-3">
				<div class="card card-border mb-0 h-100">
					<div class="card-header card-header-action">
						<h6>Weekly Finance Overview</h6>
					</div>
					<div class="card-body">
						<div class="text-center">
							<div class="d-inline-block">
								<span class="badge-status">
									<span class="badge bg-primary badge-indicator badge-indicator-nobdr"></span>
									<span class="badge-label">Expense Amount</span>
								</span>
							</div>
							<div class="d-inline-block ms-3">
								<span class="badge-status">
									<span class="badge bg-primary-light-4 badge-indicator badge-indicator-nobdr" style="background-color:#585858;"></span>
									<span class="badge-label">Receipt Amount</span>
								</span>
							</div>
							<div class="d-inline-block ms-3">
								<span class="badge-status">
									<span class="badge badge-indicator badge-indicator-nobdr" style="background-color:#585858;"></span>
									<span class="badge-label">Invoice Amount</span>
								</span>
							</div>
						</div>
						<canvas id="myChart"></canvas>
						<div class="separator-full mt-5"></div>
						<div class="flex-grow-1 ms-lg-3">
							<div class="row">
								<div class="col-xxl-4 col-sm-6 mb-xxl-0 mb-3">
									<span class="d-block fw-medium fs-7">Invoice Summary</span>
									<div class="d-flex align-items-center">
										<span class="d-block fs-4 fw-medium text-dark mb-0">Rs. {{today_invoice_total}}</span>
									</div>
								</div>
								<div class="col-xxl-4 col-sm-6 mb-xxl-0 mb-3">
									<span class="d-block fw-medium fs-7">Expenses Summary</span>
									<div class="d-flex align-items-center">
										<span class="d-block fs-4 fw-medium text-dark mb-0">Rs. {{today_expense_total}}</span>
									</div>
								</div>
								<div class="col-xxl-4 col-sm-6 mb-xxl-0 mb-3">
									<span class="d-block fw-medium fs-7">Receipt summary</span>
									<div class="d-flex align-items-center">
										<span class="d-block fs-4 fw-medium text-dark mb-0">Rs. {{today_receipt_total}}</span>
									</div>
								</div>
								
							</div>	
						</div>
					</div>
				</div>
			</div>
			
		</div>
	</div>
</div>




<script>
  // Define the data for Invoice, expense, and receipt
  const invoiceData = [{% for totals in totals_by_day %}{{ totals.invoice_total|default_if_none:0 }}{% if not forloop.last %}, {% endif %}{% endfor %}];
  const expenseData = [{% for totals in totals_by_day %}{{ totals.expense_total|default_if_none:0 }}{% if not forloop.last %}, {% endif %}{% endfor %}];
  const receiptData = [{% for totals in totals_by_day %}{{ totals.receipt_total|default_if_none:0 }}{% if not forloop.last %}, {% endif %}{% endfor %}];

  // Define the labels for the last 7 days
  const labels = [{% for totals in totals_by_day %}"{{ totals.date }}"{% if not forloop.last %}, {% endif %}{% endfor %}];
  // Create the chart
  const ctx = document.getElementById('myChart').getContext('2d');
  const chart = new Chart(ctx, {
	type: 'line',
	data: {
	  labels: labels,
	  datasets: [{
		label: 'Invoice',
		data: invoiceData,
		borderColor: '#585858',
		fill: false
	  }, {
		label: 'Expense',
		data: expenseData,
		borderColor: '#007D88',
		fill: false
	  }, {
		label: 'Receipt',
		data: receiptData,
		borderColor: '#25cba1',
		fill: false
	  }]
	},
	options: {
		legend: {
		  show: false
		},
		responsive: true,
		scales: {
		  xAxes: [{
			display: true,
			scaleLabel: {
			  display: true,
			  labelString: 'Date'
			}
		  }],
		  yAxes: [{
			display: true,
			scaleLabel: {
			  display: true,
			  labelString: 'Amount'
			}
		  }]
		}
	  }
	});
	const legend = chart.generateLegend();
	legend.style.display = 'none';
</script>

{% include 'footer.html' %}