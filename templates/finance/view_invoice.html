{% load static %}{% include 'header.html' %}
<!-- Main Content -->
<div class="hk-pg-wrapper">
	<div class="container-xxl">
		<!-- Page Header -->												
		<div class="hk-pg-header">
			<div class="d-flex">
				<div class="d-flex flex-wrap justify-content-between flex-1">
					<div class="mb-md-0 mb-2 me-8">
						<div class="d-flex align-items-center">
							<h1 class="pg-title">View Invoice</h1>
							<span class="badge badge-soft-primary ms-3">{{invoice.id}}</span>
						</div>
						<p>Generated on {{invoice.created}} </p>
						
					</div>
					<div class="pg-header-action-wrap">
						<button class="btn btn-outline-secondary me-3">Mail to Client</button>
						<button class="btn btn-primary" onclick="CreatePDFfromHTML()">Print</button>
					</div>
				</div>
			</div>
		</div>




        <div class="invoiceapp-content">
            <div class="invoiceapp-detail-wrap html-content">
                <div class="invoice-body">
                    <div class="nicescroll-bar">
                        <div class="container">
                            <div class="template-invoice-wrap mt-xxl-5 p-md-5 p-3">
                                <div class="row">
                                    <div class="col-lg-3 col-md-5 order-md-0 order-1">
                                        <img src="{{company.company_logo.url}}" alt="{{company.company_name}}" height="80">
                                    </div>
                                    <div class="col-lg-4 offset-lg-5 offset-md-3 col-md-4 mb-md-0 mb-2">
                                        <h2 class="d-flex justify-content-md-end mb-0">Invoice #{{invoice.id}}</h2>
                                    </div>	
                                </div>	
                                <div class="row mt-4">
                                    <div class="col-md-4 order-md-0 order-1">
                                        <div class="address-wrap">
                                            <h6>{{company.company_name}}</h6>
                                            <p>{{company.company_address}}</p>
                                            <p>{{company.company_email}}</p>
                                            <p>{{company.company_contact_number}}</p>
                                        </div>
                                    </div>
                                    <div class="col-md-5 offset-md-3 mb-4 mb-md-0">
                                        <div class="d-flex justify-content-md-end">
                                            <div class="text-md-end me-3">
                                                
                                                <div class="mb-1">Invoice Date*</div>
                                                <div class="mb-1">Due Date*</div>
                                                <div>Created By</div>
                                            </div>
                                            <div class="text-dark">
                                                
                                                <div class="mb-1">{{invoice.created}}</div>
                                                <div class="mb-1">{{invoice.created}}</div>
                                                <div>{{invoice.created_by}}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="separator separator-light"></div>
                                <div class="row">
                                    <div class="col-md-3">
                                        <h6 class="text-uppercase fs-7 mb-2">Billed To</h6>
                                        <div class="Billto-wrap">
                                            <h6>{{invoice.customer.client_name}}</h6>
                                            <p>{{invoice.customer.address}}</p>
                                            <p>{{invoice.customer.contact}}</p>
                                            <p>{{invoice.customer.email}}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="table-wrap mt-6">
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead class="thead-primary">
                                                <tr>
                                                    <th  colspan="4">Item</th>
                                                    <th class="text-center">Quantity</th>
                                                    <th class="text-end">Amount</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for product in product %}
                                                <tr>
                                                    <td class="w-70" colspan="4">
                                                        <h6>{{product.product}}</h6>
                                                    </td>
                                                    <td class="w-20 text-center text-dark">{{product.product_quantity}}</td>
                                                    <td class="w-20 text-end text-dark">Rs. {{product.product_price}}</td>
                                                </tr>
                                                {% endfor %}


                                                {% if invoice.misc_name and invoice.misc_amount %}
                                                <tr>
                                                   
                                                    <td class="w-70" colspan="4">
                                                        <h6>{{invoice.misc_name}}</h6>
                                                    </td>
                                                    <td></td>
                                                    <td class="w-20 text-end text-dark">Rs. {{invoice.misc_amount}}</td>
                                                </tr>
                                                {% endif %}

                                                {% if vat_amount %}
                                                <tr>
                                                    <td></td>
                                                    <td colspan="4" class="border-0 text-end ">13% VAT</td>
                                                    <td class="text-end text-dark">Rs. {{invoice.vat_amount}}</td>
                                                </tr>
                                                {% endif %}
                                                
                                                <tr>
                                                    <td></td>
                                                    <td colspan="4" class="text-dark border text-end ">Grand Total</td>
                                                    <td class="text-end text-dark border">Rs. {{invoice.invoice_amount}}</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>	
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <h6>Note to client</h6>
                                        
                                        <p>{{company.payment_details|safe}}</p>
                                        {% comment %} <img src="{% static 'qr.png' %}" alt="qr code" height="300"> {% endcomment %}
                                    </div>
                                    <div class="col-lg-6">
                                        <h6>Terms & Conditions</h6>
                                        <p>{{company.payment_terms|safe}}</p>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
                              <script>
                            function CreatePDFfromHTML() {
                                    var HTML_Width = $(".html-content").width();
                                    var HTML_Height = $(".html-content").height();
                                    var top_left_margin = 2;
                                    var PDF_Width = HTML_Width + (top_left_margin * 2);
                                    var PDF_Height = (PDF_Width * 1.5) + (top_left_margin * 2);
                                    var canvas_image_width = HTML_Width;
                                    var canvas_image_height = HTML_Height;
                                
                                    var totalPDFPages = Math.ceil(HTML_Height / PDF_Height) - 1;
                                
                                    html2canvas($(".html-content")[0]).then(function (canvas) {
                                        var imgData = canvas.toDataURL("image/jpeg", 1.0);
                                        var pdf = new jsPDF('p', 'pt', [PDF_Width, PDF_Height]);
                                        pdf.addImage(imgData, 'JPG', top_left_margin, top_left_margin, canvas_image_width, canvas_image_height);
                                        for (var i = 1; i <= totalPDFPages; i++) { 
                                            pdf.addPage(PDF_Width, PDF_Height);
                                            pdf.addImage(imgData, 'JPG', top_left_margin, -(PDF_Height*i)+(top_left_margin*4),canvas_image_width,canvas_image_height);
                                        }
                                        pdf.save("spell_innovation_invoice_{{invoice.id}}.pdf");
                                    });
                                }
                            </script>

	</div>
</div>
{% include 'footer.html' %}