{% load static %}{% include 'nav_links.html' %}

<div class="container mt-5">
    <div class="container html-content" id='printMe'>
        <div class="template-invoice-wrap mt-xxl-5 p-md-5 p-3">
            <div class="row logorow">
                <div class="col-lg-3 col-md-5 order-md-0 order-1 logo">
                    <img src="{{company.company_logo.url}}" alt="{{company.company_name}}" height="80">
                </div>
                <div class="col-lg-4 offset-lg-5 offset-md-3 col-md-4 mb-md-0 mb-2">
                    <h2 class="d-flex justify-content-md-end mb-0 invoiceid">Receipt #{{receipt.id}}</h2>
                </div>	
            </div>	
            <div class="row mt-4">
                <div class="col-md-4 order-md-0 order-1">
                    <div class="address-wrap">
                        <h6>{{company.company_name}}</h6>
                        <p>{{company.company_address}}</p>
                        <p>{{company.company_email}}</p>
                        <p>{{company.company_contact_number}}</p>
                    </div>
                </div>
                <div class="col-md-5 offset-md-3 mb-4 mb-md-0">
                    <div class="d-flex justify-content-md-end">
                        <div class="text-md-end me-3">
                            
                            <div class="mb-1">Receipt Date*</div>
                            <div>Created By</div>
                        </div>
                        <div class="text-dark">
                            
                            <div class="mb-1">{{receipt.created}}</div>
                            <div>{{receipt.created_by}}</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="separator separator-light"></div>
            <div class="row">
                <div class="col-md-3">
                    <h6 class="text-uppercase fs-7 mb-2">Billed To</h6>
                    <div class="Billto-wrap">
                        <h6>{{receipt.customer.client_name}}</h6>
                        <p>{{receipt.customer.address}}</p>
                        <p>{{receipt.customer.contact}}</p>
                        <p>{{receipt.customer.email}}</p>
                    </div>
                </div>
            </div>
            <div class="table-wrap mt-6" >
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead class="thead-primary">
                            <tr>
                                <th  colspan="4" >Description</th>
                                <th class="text-end">Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            
                            <tr>
                                <td class="w-70" colspan="4">
                                    <h6>Paid Amount</h6>
                                </td>
                                <td class="w-20 text-end text-dark">Rs. {{receipt.paid_amount}}</td>
                            </tr>
                            
                            <tr>
                                <td colspan="4" class="text-dark border text-end ">Payment Method</td>
                                <td class="text-end text-dark border">{{receipt.payment_method}}</td>
                            </tr>
                            <tr>
                                <td colspan="4" class="text-dark border text-end ">Total</td>
                                <td class="text-end text-dark border">Rs. {{receipt.paid_amount}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>	
            </div>
            <div class="row">
                <div class="col-lg-6 col-md-6">
                    <h6>Thank you for the purchase.</h6>
                </div>
                <div class="col-lg-6 col-md-6">
                  {% if receipt.payment_receipt %}
                  <h6>Receipt Screenshot</h6>
                    <img src="{{receipt.payment_receipt.url}}" alt="payment_receipt" width=" 600">
                    {% endif %}
                    
                </div>
            </div>
        </div>
    </div>

    <div class="container btns">
        <button class="btn btn-outline-secondary me-3"  onclick="printDiv('printMe')">Print</button>
        <button class="btn btn-primary" onclick="CreatePDFfromHTML()">Download</button>
    </div>
</div>






<style type = "text/css">
       @media print {
        * {
                all: unset;
            }

          .logorow{
            display: flex;
            justify-content: space-between;
          }
          .invoiceid{
            color: red;
          }
       }
</style>
<script>
    function printDiv(divName){
        var printContents = document.getElementById(divName).innerHTML;
        var originalContents = document.body.innerHTML;

        document.body.innerHTML = printContents;

        window.print();

        document.body.innerHTML = originalContents;

    }
</script>
<script>
    function CreatePDFfromHTML() {
            var HTML_Width = $(".html-content").width();
            var HTML_Height = $(".html-content").height();
            var top_left_margin = 2;
            var PDF_Width = HTML_Width + (top_left_margin * 2);
            var PDF_Height = (PDF_Width * 1.5) + (top_left_margin * 2);
            var canvas_image_width = HTML_Width;
            var canvas_image_height = HTML_Height;
        
            var totalPDFPages = Math.ceil(HTML_Height / PDF_Height) - 1;
        
            html2canvas($(".html-content")[0]).then(function (canvas) {
                var imgData = canvas.toDataURL("image/jpeg", 1.0);
                var pdf = new jsPDF('p', 'pt', [PDF_Width, PDF_Height]);
                pdf.addImage(imgData, 'JPG', top_left_margin, top_left_margin, canvas_image_width, canvas_image_height);
                for (var i = 1; i <= totalPDFPages; i++) { 
                    pdf.addPage(PDF_Width, PDF_Height);
                    pdf.addImage(imgData, 'JPG', top_left_margin, -(PDF_Height*i)+(top_left_margin*4),canvas_image_width,canvas_image_height);
                }
                pdf.save("spell_innovation_receipt_{{receipt.id}}.pdf");
            });
        }
    </script>

{% include 'footer.html' %}